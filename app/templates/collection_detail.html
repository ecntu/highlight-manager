{% extends "base.html" %}

{% block content %}
<div class="card">
    <div class="row-between" style="align-items: start; margin-bottom: 20px;">
        <div>
            <h2 class="section-title" style="margin-bottom: 5px;">{{ collection.name }}</h2>
            <p class="muted" style="margin-bottom: 10px;">{{ collection.description or "No description" }}</p>
            <small class="muted-2">{{ collection.highlights|length }} highlights</small>
        </div>
        <div class="row" style="gap: 10px;">
            <button onclick="document.getElementById('edit-form').style.display='block'; this.style.display='none';"
                class="btn btn--ghost btn--sm">
                Edit
            </button>
            <button hx-delete="/collections/{{ collection.id }}"
                hx-confirm="Are you sure you want to delete this collection?" hx-target="body"
                hx-on::after-request="window.location='/collections'" class="btn btn--danger btn--sm">
                Delete
            </button>
        </div>
    </div>

    <form id="edit-form"
        style="display: none; margin-bottom: 20px; padding: 20px; background: #f8f9fa; border-radius: 8px;"
        hx-patch="/collections/{{ collection.id }}" hx-target="#edit-form" hx-swap="beforebegin">
        <div class="form-group">
            <label>Name</label>
            <input type="text" name="name" value="{{ collection.name }}" required>
        </div>
        <div class="form-group">
            <label>Description</label>
            <textarea name="description" rows="3">{{ collection.description or "" }}</textarea>
        </div>
        <div class="row" style="gap: 10px;">
            <button type="submit" class="btn btn--ghost">Save Changes</button>
            <button type="button"
                onclick="this.closest('form').style.display='none'; this.closest('.card').querySelector('button').style.display='inline-block';"
                class="btn btn--ghost btn--sm">
                Cancel
            </button>
        </div>
    </form>
</div>

<div class="card">
    <h3 class="section-title" style="margin-bottom: 15px;">Highlights in this Collection</h3>
    {% if collection.highlights %}
    <div class="stack" style="gap: 15px;">
        {% for highlight in collection.highlights %}
        <div class="list-card" style="background: #f8f9fa; position: relative;">
            <button hx-delete="/collections/{{ collection.id }}/highlights/{{ highlight.id }}" hx-target="closest div"
                hx-swap="outerHTML" class="btn btn--danger btn--sm" style="position: absolute; top: 10px; right: 10px;">
                Remove
            </button>
            <p style="margin-bottom: 10px;">{{ highlight.text }}</p>
            {% if highlight.source %}
            <small class="muted">
                From: <a href="/sources/{{ highlight.source.id }}" style="color: #007bff; text-decoration: none;">
                    {{ highlight.source.name }}
                </a>
            </small>
            {% endif %}
            <br>
            <a href="/highlights/{{ highlight.id }}" style="color: #007bff; text-decoration: none; font-size: 12px;">
                View details â†’
            </a>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p class="muted" style="text-align: center; padding: 40px 0;">
        No highlights in this collection yet.
    </p>
    {% endif %}
</div>

<div style="margin-top: 20px;">
    <a href="/collections" style="color: #007bff; text-decoration: none;">&larr; Back to Collections</a>
</div>
{% endblock %}