{% extends "base.html" %}

{% block title %}Search{% endblock %}

{% block content %}
<div class="card">
    <form hx-get="/search" hx-target="#search-results" hx-swap="innerHTML"
        hx-trigger="input changed delay:300ms from:#search-input, change from:select">
        <div style="display: flex; justify-content: space-between; align-items: center; gap: 16px; margin-bottom: 24px;">
            <!-- Main Search -->
            <input type="text" id="search-input" name="q" value="{{ query or '' }}"
                placeholder="Search highlights, notes, sources..." style="flex: 1; font-size: 15px; padding: 10px 14px;"
                autofocus>
            
            <!-- Filters -->
            <div style="display: flex; gap: 12px; align-items: center;">
                <select name="source_type" style="padding: 6px 10px; font-size: 13px; border-radius: 6px; width: auto;">
                    <option value="">All Types</option>
                    <option value="book" {% if source_type=='book' %}selected{% endif %}>Books</option>
                    <option value="web" {% if source_type=='web' %}selected{% endif %}>Web</option>
                    <option value="article" {% if source_type=='article' %}selected{% endif %}>Articles</option>
                    <option value="podcast" {% if source_type=='podcast' %}selected{% endif %}>Podcasts</option>
                </select>

                <select name="favorite" style="padding: 6px 10px; font-size: 13px; border-radius: 6px; width: auto;">
                    <option value="">All Highlights</option>
                    <option value="true" {% if favorite=='true' %}selected{% endif %}>Favorites Only</option>
                </select>

                <select name="status" style="padding: 6px 10px; font-size: 13px; border-radius: 6px; width: auto;">
                    <option value="">Active & Archived</option>
                    <option value="active" {% if status=='active' %}selected{% endif %}>Active</option>
                    <option value="archived" {% if status=='archived' %}selected{% endif %}>Archived</option>
                </select>
                
                <select name="sort" style="padding: 6px 10px; font-size: 13px; border-radius: 6px; width: auto;">
                    <option value="recent-desc" {% if sort=='recent-desc' or not sort %}selected{% endif %}>Recent First</option>
                    <option value="recent-asc" {% if sort=='recent-asc' %}selected{% endif %}>Oldest First</option>
                    <option value="relevance" {% if sort=='relevance' %}selected{% endif %}>Most Relevant</option>
                </select>
            </div>
        </div>
    </form>
</div>

<!-- Results -->
{% if query or source_type or source_id or collection_id or tag or status or favorite %}
<div style="display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 16px;">
    <h2 style="font-size: 18px; font-weight: 600; color: #1a1a1a;">
        {% if query %}Results for "{{ query }}"{% else %}Filtered Results{% endif %}
    </h2>
    <small style="color: #999; font-size: 13px;">{{ results|length }} found</small>
</div>

<div id="search-results">
    {% include "partials/search_results.html" %}
</div>
{% else %}
<div style="text-align: center; padding: 48px 24px; color: #999;">
    <svg xmlns="http://www.w3.org/2000/svg" style="width: 48px; height: 48px; margin: 0 auto 16px; opacity: 0.3;"
        fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
    </svg>
    <p style="font-size: 15px;">Start typing to search your highlights</p>
</div>
{% endif %}
{% endblock %}