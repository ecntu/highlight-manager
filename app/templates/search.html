{% extends "base.html" %}

{% block title %}Search{% endblock %}

{% block content %}
<div class="card">
    <form hx-get="/search" hx-target="#search-results"
        hx-trigger="input changed delay:300ms from:#search-input, change from:select">
        <!-- Main Search -->
        <div style="margin-bottom: 20px;">
            <input type="text" id="search-input" name="q" value="{{ query or '' }}"
                placeholder="Search highlights, notes, sources..." style="font-size: 16px; padding: 14px 16px;"
                autofocus>
        </div>

        <!-- Filters -->
        <details style="margin-bottom: 16px;">
            <summary style="cursor: pointer; color: #666; font-size: 14px; font-weight: 500; user-select: none;">
                <span style="margin-left: 4px;">Advanced Filters</span>
            </summary>
            <div
                style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 16px; padding-top: 16px; border-top: 1px solid #f0f0f0;">
                <select name="source_type">
                    <option value="">All Types</option>
                    <option value="book" {% if source_type=='book' %}selected{% endif %}>Books</option>
                    <option value="web" {% if source_type=='web' %}selected{% endif %}>Web</option>
                </select>

                <select name="status">
                    <option value="">All Status</option>
                    <option value="active" {% if status=='active' %}selected{% endif %}>Active</option>
                    <option value="archived" {% if status=='archived' %}selected{% endif %}>Archived</option>
                </select>

                <select name="favorite">
                    <option value="">All Highlights</option>
                    <option value="true" {% if favorite=='true' %}selected{% endif %}>‚≠ê Favorites</option>
                </select>
            </div>
        </details>
    </form>
</div>

<!-- Results -->
{% if query or source_type or status or favorite %}
<div style="display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 16px;">
    <h2 style="font-size: 18px; font-weight: 600; color: #1a1a1a;">
        {% if query %}Results for "{{ query }}"{% else %}Filtered Results{% endif %}
    </h2>
    <small style="color: #999; font-size: 13px;">{{ results|length }} found</small>
</div>

<div id="search-results">
    {% include "partials/search_results.html" %}
</div>
{% else %}
<div style="text-align: center; padding: 48px 24px; color: #999;">
    <svg xmlns="http://www.w3.org/2000/svg" style="width: 48px; height: 48px; margin: 0 auto 16px; opacity: 0.3;"
        fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
    </svg>
    <p style="font-size: 15px;">Start typing to search your highlights</p>
</div>
{% endif %}
{% endblock %}