{% extends "base.html" %}

{% block title %}Search{% endblock %}

{% block content %}
<div class="card">
    <form hx-get="/search" hx-target="#search-results" hx-swap="innerHTML"
        hx-trigger="input changed delay:300ms from:#search-input, change from:select">
        <div class="row-between" style="margin-bottom: 24px;">
            <!-- Main Search -->
            <input type="text" id="search-input" name="q" value="{{ query or '' }}"
                placeholder="Search highlights, notes, sources..." class="input-lg" style="flex: 1;" autofocus>

            <!-- Filters -->
            <div class="row" style="gap: 12px;">
                <select name="source_type" class="select-compact">
                    <option value="">All Types</option>
                    <option value="book" {% if source_type=='book' %}selected{% endif %}>Books</option>
                    <option value="web" {% if source_type=='web' %}selected{% endif %}>Web</option>
                    <option value="article" {% if source_type=='article' %}selected{% endif %}>Articles</option>
                    <option value="podcast" {% if source_type=='podcast' %}selected{% endif %}>Podcasts</option>
                </select>

                <select name="favorite" class="select-compact">
                    <option value="">All Highlights</option>
                    <option value="true" {% if favorite=='true' %}selected{% endif %}>Favorites Only</option>
                </select>

                <select name="status" class="select-compact">
                    <option value="">Active & Archived</option>
                    <option value="active" {% if status=='active' %}selected{% endif %}>Active</option>
                    <option value="archived" {% if status=='archived' %}selected{% endif %}>Archived</option>
                </select>

                <select name="sort" class="select-compact">
                    <option value="recent-desc" {% if sort=='recent-desc' or not sort %}selected{% endif %}>Recent First
                    </option>
                    <option value="recent-asc" {% if sort=='recent-asc' %}selected{% endif %}>Oldest First</option>
                    <option value="relevance" {% if sort=='relevance' %}selected{% endif %}>Most Relevant</option>
                </select>
            </div>
        </div>
    </form>
</div>

<!-- Results -->
{% if query or source_type or source_id or collection_id or tag or status or favorite %}
<div class="section-header">
    <h2 class="section-title">
        {% if query %}Results for "{{ query }}"{% else %}Filtered Results{% endif %}
    </h2>
    <small class="section-meta">{{ results|length }} found</small>
</div>

<div id="search-results">
    {% include "partials/search_results.html" %}
</div>
{% else %}
<div style="text-align: center; padding: 48px 24px; color: #999;">
    <svg class="icon" xmlns="http://www.w3.org/2000/svg" style="width: 48px; height: 48px; margin: 0 auto 16px; opacity: 0.3;"
        fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
    </svg>
    <p style="font-size: 15px;">Start typing to search your highlights</p>
</div>
{% endif %}
{% endblock %}
