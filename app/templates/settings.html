{% extends "base.html" %}

{% block content %}
<div class="card">
    <h2 style="margin-bottom: 20px;">Device API Keys</h2>

    {% if new_api_key %}
    <div
        style="background: #d4edda; border: 1px solid #c3e6cb; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
        <strong>New API Key Created!</strong><br>
        <p style="margin: 10px 0 5px 0;">Save this key - it won't be shown again:</p>
        <code style="background: white; padding: 8px; display: block; word-break: break-all;">{{ new_api_key }}</code>
    </div>
    {% endif %}

    <form hx-post="/devices" hx-target="#devices-table" hx-swap="outerHTML" style="margin-bottom: 30px;">
        <div style="display: flex; gap: 10px;">
            <input type="text" name="name" placeholder="Device name (e.g., iPhone, MacBook)" required style="flex: 1;">
            <button type="submit">
                Create Device Key
                <span class="htmx-indicator">...</span>
            </button>
        </div>
    </form>

    <h3 style="margin-bottom: 15px; font-size: 16px;">Active Devices</h3>
    <div id="devices-table">
        {% include "partials/devices_table.html" %}
    </div>
</div>

<div class="card">
    <h2 style="margin-bottom: 10px;">Using Device Keys</h2>
    <p style="color: #666; margin-bottom: 15px;">Send highlights from any device using:</p>
    <pre style="background: #f5f5f5; padding: 15px; border-radius: 4px; overflow-x: auto; font-size: 13px;">curl -X POST {{ request.url.scheme }}://{{ request.url.netloc }}/api/highlights \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -F "text=Your highlight text" \
  -F "note=Optional note" \
  -F "tags=tag1,tag2" \
  -F "source_url=https://example.com/article" \
  -F "source_title=Article Title" \
  -F "source_author=Author Name"

# For books, use title instead of URL:
curl -X POST {{ request.url.scheme }}://{{ request.url.netloc }}/api/highlights \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -F "text=Your highlight text" \
  -F "source_title=Book Title" \
  -F "source_author=Author Name"</pre>
</div>
{% endblock %}