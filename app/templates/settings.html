{% extends "base.html" %}

{% block content %}
<div class="card">
    <h2 style="margin-bottom: 20px;">Device API Keys</h2>

    {% if new_api_key %}
    <div
        style="background: #d4edda; border: 1px solid #c3e6cb; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
        <strong>New API Key Created!</strong><br>
        <p style="margin: 10px 0 5px 0;">Save this key - it won't be shown again:</p>
        <code style="background: white; padding: 8px; display: block; word-break: break-all;">{{ new_api_key }}</code>
    </div>
    {% endif %}

    <form method="post" action="/devices/create" style="margin-bottom: 30px;">
        <div style="display: flex; gap: 10px;">
            <input type="text" name="name" placeholder="Device name (e.g., iPhone, MacBook)" required style="flex: 1;">
            <button type="submit">Create Device Key</button>
        </div>
    </form>

    <h3 style="margin-bottom: 15px; font-size: 16px;">Active Devices</h3>
    {% if devices %}
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="border-bottom: 2px solid #e0e0e0;">
                <th style="text-align: left; padding: 10px 0;">Name</th>
                <th style="text-align: left; padding: 10px 0;">Created</th>
                <th style="text-align: left; padding: 10px 0;">Last Used</th>
                <th style="text-align: left; padding: 10px 0;"></th>
            </tr>
        </thead>
        <tbody>
            {% for device in devices %}
            <tr style="border-bottom: 1px solid #f0f0f0;">
                <td style="padding: 12px 0;">{{ device.name }}</td>
                <td style="padding: 12px 0; color: #666;">{{ device.created_at.strftime('%b %d, %Y') }}</td>
                <td style="padding: 12px 0; color: #666;">
                    {% if device.last_used_at %}
                    {{ device.last_used_at.strftime('%b %d, %Y') }}
                    {% else %}
                    Never
                    {% endif %}
                </td>
                <td style="padding: 12px 0; text-align: right;">
                    <form method="post" action="/devices/{{ device.id }}/revoke" style="display: inline;">
                        <button type="submit" class="secondary"
                            style="padding: 6px 12px; font-size: 13px;">Revoke</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="color: #666;">No devices yet. Create one above to start capturing highlights from other devices.</p>
    {% endif %}
</div>

<div class="card">
    <h2 style="margin-bottom: 10px;">Using Device Keys</h2>
    <p style="color: #666; margin-bottom: 15px;">Send highlights from any device using:</p>
    <pre style="background: #f5f5f5; padding: 15px; border-radius: 4px; overflow-x: auto; font-size: 13px;">curl -X POST {{ request.url.scheme }}://{{ request.url.netloc }}/api/ingest/highlight \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -F "text=Your highlight text" \
  -F "note=Optional note" \
  -F "tags=tag1,tag2" \
  -F "source_title=Book Title" \
  -F "source_type=book" \
  -F "source_author=Author Name"</pre>
</div>
{% endblock %}